\documentclass[oneside,reqno,letterpaper]{amsart}
\usepackage{/Users/aden/Library/CloudStorage/Box-Box/latex/adenc}
% \AddToHook{cpd/section/before}{\clear page}
\usepackage{xspace}

\input{preamble.tex}

\usepackage{biblatex}
\addbibresource{ref.bib}



\title[]{}
\author{Aden Chen}



\begin{document}
\maketitle

\tableofcontents

\section{Optimal Transport}

Consider the problem of optimally transporting some mass.
The spatial distributions of the mass can be described (after normalizing the total amount of mass to unity) by a probability measure on some space.
Let \(\mu \in \Pspace(X)\) and \(\nu \in \Pspace(Y)\) describe the initial and target mass distribution, respectively.
Here, \(\Pspace\) is used to denote the space of Borel probability measures on a given space.


Focusing solely on the initial distribution of each piece of mass, we can describe each \vocab{transport plan} using a probability measure on the product space, \(\gamma \in \Pspace(X \times Y)\), where \(\gamma(A \times B)\) gives the amount of mass initially located in \(A\) and subsequently transferred to \(B\).
The requirement that the initial and target mass distributions are respected then amounts to
\[
  \gamma(A \times Y) = \mu(A) \quad \text{and} \quad \gamma(X \times B) = \nu(B)
\]
for all measurable sets \(A \subseteq X\) and \(B \subseteq Y\).
That is, each transport plan \(\gamma\) has marginals \(\mu\) and \(\nu\).
Each measure with such properties will be called a \vocab{coupling} of \(\mu\) and \(\nu\).
% From a probabilistic perspective, \(\gamma\) is a coupling of the probability measures \(\mu\) and \(\nu\).
The set of all couplings of \(\mu\) and \(\nu\) will be denoted by \(\Pi(\mu, \nu)\).


Now, let the measurable \vocab{cost function} \(c: X \times Y \to [0, +\infty]\) describe the cost of transporting a unit mass from point \(x \in X\) to point \(y \in Y\) by \(c(x, y)\).
For each transport plan \(\gamma \in \Pi(\mu, \nu)\), the total transport cost is then given by
\[
  \Kan(\gamma) \coloneqq \int_{X \times Y} c(x, y) \dd \gamma(x, y).
\]
The first version of the optimal transport problem, the \vocab{Kantorovich problem}, is to minimize this cost:
\begin{problem*}[Kantorovich Problem]
  Minimize
  \[
    \Kan(\gamma)
    \coloneqq \int_{X \times Y} c(x, y) \dd \gamma(x, y).
  \]
  over all \(\gamma \in \Pi(\mu, \nu)\).
  The infimum cost for cost \(c\) will be denoted by \(\OTcost_c(\mu, \nu)\).
\end{problem*}

\begin{itodo}
  linearity
\end{itodo}


The Kantorovich problem can be considered as a relaxation of a related, and historically earlier, version of the optimal transport problem, the \vocab{Monge problem}.
In the Monge problem, we impose the additional constraint that mass from each point \(x \in X\) cannot be divided.
With this constraint, a transport plan can be described by a \vocab{transport map}, a measurable function \(T: X \to Y\) such that each piece of mass initially located at \(x\) is transported to \(T(x)\).
The requirement that the initial and target mass distributions are respected then amounts to
\[
  \nu(B) = \mu(T^{-1}(B))
\]
for all measurable sets \(B \subseteq Y\).
Equivalently, the transport map \(T\) must satisfy \(T_\# \mu = \nu\), where \(T_\# \mu\) is the \vocab{pushforward} of \(\mu\) by \(T\).
For a transport map \(T\) with this property, we have the associated transport plan \(\gamma_T = (\Id, T)_\# \mu\) and cost
\[
  \Mon(T)
  \coloneqq \Kan(\gamma_T)
  = \int_{X \times Y} c(x, y) \dd \gamma_T(x, y)
  = \int_{X} c(x, T(x)) \dd \mu(x).
\]
The Monge problem can be summarized as follows:
\begin{problem*}[Monge]
  Minimize
  \[
    \Mon(T)
    \coloneqq \int_{X} c(x, T(x)) \dd \mu(x).
  \]
  for all measurable maps \(T: X \to Y\) such that \(T_\# \mu = \nu\).
\end{problem*}


Since for each transport map \(T\), there is an associated transport plan \(\gamma_T\), we may view the Kantorovich problem as a relaxation of the Monge problem where we minimize over a larger set of transport plans.
From this we have
\[
  \inf_{\gamma \in \Pi(\mu, \nu)} \Kan(\gamma)
  \leq \inf_{T: T_\# \mu = \nu} \Mon(T).
\]

The next two subsections will discuss the existence of optimal transport for both problems and when equality can be achieved.


\subsection{Existence of Optimal Transport}
We start with the existence of optimal transport for the Kantorovich problem.
A standard compactness and lower semi-continuity argument will be used:
we choose a sequence \(\gamma_n \in \Pi(\mu, \nu)\) such that \(\Kan(\gamma_n) \to \inf_{\gamma \in \Pi(\mu, \nu)} \Kan(\gamma)\), extract by compactness a subsequence that converges to some \(\gamma \in \Pi(\mu, \nu)\), and show that \(\gamma\) achieves the infimum.


The compactness of \(\Pi(\mu, \nu)\) will be given by Prokhorov's theorem, which we now recall:
\begin{theorem}[Prokhorov]\label{prop:prokhorov}
  Let \((X, d)\) be a complete separable metric space.\todo{can we improve this to Polish?}
A set \(\cM \subset \Pspace(X)\) is relatively compact in the weak topology if and only if it is \vocab{tight}, that is, for every \(\varepsilon > 0\), there exists a compact set \(K \subset X\) such that \(\sup_{\mu \in \cM} \mu(K^\complement) < \epsilon\).
\end{theorem}
\begin{proof}
  See \cite[Theorem 7.9]{Zitkovic2013weak}.\todo{Find reference that proves compactness instead of just sequential compactness.}
\end{proof}

When \(X, Y \subset \RR^d\), by considering the increasing sequence \(([-n, n]^d)_{n \in \NN} \nearrow \RR^d\), we can find compact sets \(K_X \subset X\) and \(K_Y \subset Y\) such that \(\mu(K_X^\complement), \nu(K_Y^\complement) < \varepsilon / 2\).
More generally, when \(X, Y\) are Polish spaces, \(K_X\) and \(K_Y\) can be found using \vocab{Ulam's lemma}\todo{add ref}.
Now, for any \(\gamma \in \Pi(\mu, \nu)\), we have
\[
  \gamma\left( (K_X \times K_Y)^\complement \right)
  \leq \gamma(K_X^\complement \times Y) + \gamma(X \times K_Y^\complement)
  \leq \mu(K_X^\complement) + \nu(K_Y^\complement)
  \leq \varepsilon.
\]
Thus \(\Pi(\mu, \nu)\) is tight and, by \Cref{prop:prokhorov}, relatively weakly compact.
% This result can be easily extended to the following slightly stronger form:
This is sufficient for proving existence for the Kantorovich problem, but we state the following obvious generalization, which will be useful later on:
% , but we mention a somewhat stronger result that we will use later on and which can be proved using the same argument:
\begin{proposition}\label{prop:couplings-of-tight-is-tight}
  Let \(\cM\) and \(\cN\) be two tight sets of measures.
  Then the set of all couplings
  \[
    \left\{\gamma \in \Pi(\mu, \nu) : \mu \in \cM, \nu \in \cN \right\}
  \]
  is relatively compact in the weak topology.
  In particular, if \(X\) and \(Y\) are Polish and \(\mu \in \Pspace(X)\), \(\nu \in \Pspace(Y)\), then \(\Pi(\mu, \nu)\) is relatively compact in the weak topology.
\end{proposition}

The other ingredient of the existence proof, that \(\Kan\) is lower semicontinuous (\lsc), is an easy consequence of the following approximation theorem:
\begin{lemma}\label{prop:lsc-approx-by-uc}
  Let \(f\) be a nonnegative \lsc function on a metric space \(X\).
  Then, there exists a sequence \((f_n)_{n \in \NN}\) of bounded nonnegative uniformly continuous functions converging pointwise monotonically to \(f\).
\end{lemma}
\begin{proof}
  For each \(n\), define
  \[
    f_n(x) \coloneqq \inf_{y \in X} \left\{ f(y) + n d(x, y) \right\}.
  \]
  It is clear that each \(f_n\) is nonnegative and \(f_n(x)\) is nondecreasing in \(n\) for each \(x\).
  As the upper envelope of \(n\)-Lipschitz functions, each \(f_n\) is also \(n\)-Lipschitz and thus uniformly continuous.

  Finally, we show that \(f_n\) converges to \(f\) pointwise.
  Fix any \(x \in X\).
  By \(f\) being \lsc, for each \(\varepsilon > 0\), there exists some \(\delta > 0\) such that \(f(y) \geq f(x) - \epsilon\) for all \(y \in B(x, \delta)\).
  Find large \(N\) such that \(N \delta > f(x)\).
  We have when \(y \notin B(x, \delta)\) that
  \[
    f(y) + N d(x, y)
    \geq N \delta
    > f(x) - \varepsilon.
  \]
  Similarly, when \(y \in B(x, \delta)\), we have
  \[
    f(y) + N d(x, y)
    \geq f(x) - \varepsilon.
  \]
  Thus \(\lim_{n \to \infty} f_n(x) \geq f_N(x) \geq f(x) - \varepsilon\).
  We send \(\varepsilon \to 0\) to conclude the proof.
\end{proof}
\begin{corollary}\label{prop:Kan-lsc}
  Let \(c\) be \lsc, and let \(\cM \subset \Pspace(X)\) and \(\cN \subset \Pspace(Y)\) be tight.
  The functional
  \[
    \Kan(\gamma) \coloneqq \int_{X \times Y} c(x, y) \dd \gamma
  \]
  is \lsc in the weak topology on the set \(\left\{\gamma \in \Pi(\mu, \nu) : \mu \in \cM, \nu \in \cN \right\}\).
  In particular, if \(X, Y\) are Polish, then \(\Kan\) is weakly \lsc on \(\Pi(\mu, \nu)\) for any \(\mu \in \Pspace(X)\), \(\nu \in \Pspace(Y)\).
\end{corollary}
\begin{proof}
  Let \(c_n\) be the sequence of bounded continuous functions constructed in \Cref{prop:lsc-approx-by-uc} converging pointwise monotonically to \(c\).
  For each \(n\), the functional
  \[
    \Kan_n(\gamma) \coloneqq \int c_n(x, y) \dd \gamma(x, y)
  \]
  is continuous and in particular \lsc in the weak topology.
  The Monotone Convergence Theorem implies that \(\Kan_n \to \Kan\) pointwise.
  Since \(\Kan_n\) is nondecreasing in \(n\), we actually have \(\Kan = \sup_n \Kan_n\). % is actually the pointwise supremum of \(\Kan_n\).
  As the pointwise supremum of \lsc functions, \(\Kan\) is lower semi-continuous.
\end{proof}


We are now equipped to prove the existence of an optimal transport plan.
\begin{theorem}[Kantorovich]\label{prop:Kan-existence}
  Let \(X\) and \(Y\) be Polish, \(\mu \in \Pspace(X)\) and \(\nu \in \Pspace(Y)\), and \(c\) be a \lsc cost function.\todo{Do \(\RR^d\) instead?}
\end{theorem}
\begin{proof}
  Let \((\gamma_n)_{n \in \NN} \subseteq \Pi(\mu, \nu)\) be a minimizing sequence for the Kantorovich problem.
  Up to extraction of a subsequence, we may assume that \(\gamma_n \weakto \gamma\) for some \(\gamma \in \Pi(\mu, \nu)\).
  By \Cref{prop:Kan-lsc}, \(\inf \Kan = \liminf_n \Kan(\gamma_n) \geq \Kan(\gamma)\).
  In particular, \(\gamma\) achieves the infimum.
  % It remains to show that \(\gamma\) achieves the infimum.
  % Note that the weak convergence already implies that \(\inf \Kan = \lim_n \Kan(\gamma_n) = \Kan(\gamma)\) in the case where \(c \in C_b(X \times Y)\).
  %
  % When \(c \notin C_b(X \times Y)\), we can use \Cref{prop:lsc-approx-by-uc} to construct a sequence \(c_m\) of bounded continuous functions such that \(c_m \nearrow c\).
  % For each \(m\), define \(\Kan_m(\gamma) \coloneqq \int c_m(x, y) \dd \gamma\) to be the cost functional associated to the cost \(c_m\).
  % By the monotone convergence theorem, we have that \(\Kan\) is the pointwise supremum of the sequence \((\Kan_m)_{m \in \NN}\).
  % We have just seen that \(\Kan_m\) is continuous and in particular \lsc in the weak topology.
  % It follows thus that \(\Kan = \sup_m \Kan_m\) is always \lsc, whence
  % \[
  %   \inf \Kan = \liminf_n \Kan(\gamma_n) \geq \Kan(\gamma).
  % \]
\end{proof}


Conditions for the existence of optimal transport maps for the Monge problem are much more delicate.
We state below a set of sufficient conditions and omit the proof:
\begin{theorem}[Gangbo, McCann]\label{prop:Mon-existence}
  Let \(\mu, \nu \in \Pspace(\RR^d)\) and \(c\) be a strictly convex, superlinear cost function such that the total transport cost from \(\mu\) to \(\nu\) is not always infinite.
  Assume moreover that \(\mu\) is absolutely continuous with respect to the Lebesgue measure.
  Then, the optimal transport plan is unique and induced by a transport map.
  In particular, the Monge problem admits a unique solution.
\end{theorem}
\begin{proof}
  See \cite[Theorem 2.44]{Villani2003}.
\end{proof}



\subsection{Kantorovich as a Relaxation of Monge}
Under suitable conditions, we can show that \(\Kan\) is a relaxation of \(\Mon\) in the following sense:
\begin{definition}[Relaxation]
  Let \(F: X \to \RR \cup \left\{+\infty\right\}\) be a functional bounded from below.
  Its \vocab{relaxation} \(\overline{F}\) is the maximal \lsc functional such that \(\overline{F} \leq F\).
  The relaxation is well-defined since the pointwise supremum of any family of \lsc functionals is lower semi-continuous.
\end{definition}

The following observation gives the significance of the relaxation:
\begin{proposition}
  Let \(\overline{F}\) be the relaxation of \(F\).
  Then, \(\inf F = \inf \overline{F}\).
\end{proposition}
\begin{proof}
  From the definition above, we have \(\overline{F} \leq F\) pointwise and thus \(\inf \overline{F} \leq \inf F\).
  For the opposite inequality, note that the constant functional \(x \mapsto \inf F\) is \lsc and bounded above by \(F\).
  Since \(\overline{F}\) is the maximal such functional, we have \(\overline{F} \geq \inf F\) pointwise and so \(\inf \overline{F} \geq \inf F\).
\end{proof}


We will see that under suitable conditions, the functional \(\Kan\) is the relaxation of \(\Mon\).
In particular, when the optimal transport map \(T\) for \(\Mon\) exists, then by the result above we have
\[
  \Kan(\gamma_T)
  = \Mon(T)
  = \inf \Mon
  = \inf \Kan.
\]
And so the optimal transport plan for the Kantorovich problem is given by \(\gamma_T\).
% Since it is often easier to work with transport maps, a trick that we will use often later on is to consider for any Kantorovich problem, a sequence of approximating problems for which the optimal transport map exists.
% By the preceding discussion, the optimal transport plans for these approximating problems will be precisely induced by these optimal transport maps.



\draftnote[TODO]{Prove relaxation}
\begin{itodo}
A set of sufficient conditions for Kantorovich is the following:
\(X\), \(Y\) Polish.
\(c\) \lsc.
\(\mu\) atomless.
\end{itodo}




\subsection{Kantorovich Duality and the Kantorovich-Rubinstein Theorem}
\todo{
  I want to mention the sketch proofs of these two results since they are used in later on.
}

\begin{theorem}[Kantorovich Duality]
  Let \(X\), \(Y\) be Polish and \(c\) be a \lsc cost function.
  % Let \(X\) and \(Y\) be Polish, \(\mu \in \Pspace(X)\) and \(\nu \in \Pspace(Y)\), and \(c: X \times Y \to \RR_+ \cup \left\{+ \infty \right\}\) be \lsc.
  Let \(\varphi_c\) consist of all pairs \((\varphi, \psi) \in L^1(d\mu) \times L^1(d\nu)\) such that
  \[
    \varphi(x) + \psi(y) \leq c(x, y)
  \]
  for \(\mu\)-a.e.\ \(x \in X\) and \(\nu\)-a.e.\ \(y \in Y\).
  Then,
  \[
    % \inf_{\gamma \in \Pi(\mu, \nu)} \int_{X \times Y} c(x, y) \dd \gamma(x, y)
    \OTcost_c(\mu, \nu)
    = \sup_{(\varphi, \psi) \in \Phi_c} \left( \int_X \phi(x) \dd \mu(x) + \int_Y \psi(y) \dd \nu(y) \right).
  \]
\end{theorem}
\begin{itodo}
  A formal proof here.
\end{itodo}



\begin{theorem}[Kantorovich-Rubinstein]\label{prop:Kan-Rub}
  Let \(X = Y\) be Polish and endowed with a \lsc metric \(d\).
  Let \(\Lip(X)\) denote the space of all Lipschitz functions on \(X\), and
  \[
    \norm{\varphi}_{\Lip}
    \coloneqq \sup_{x \neq y} \frac{\abs{\varphi(x) - \phi(y)}}{d(x, y)}.
  \]
  Then,
  \[
    \OTcost_d(\mu, \nu)
    = \sup\left\{ \int_X \varphi \dd (\mu - \nu); \quad \phi \in L^1(d \abs{\mu - \nu}); \quad \norm{\varphi}_{\Lip} \leq 1 \right\}.
  \]
\end{theorem}
\begin{itodo}
\begin{proof}
\end{proof}
\end{itodo}




\section{Basic Properties of the Wasserstein Space}
\subsection{The Wasserstein Distance}
Starting from this section, we will mainly focus on the case where \(X = Y = \Omega \subset \RR^d\) and costs of the form \(c(x, y) = \abs{x - y}^p\) for \(p \geq 1\).
Given two probability measures \(\mu, \nu \in \Pspace(\Omega)\), the optimal transport cost \(\OTcost_c(\mu, \nu)\) may be viewed as a measure of distance between \(\mu\) and \(\nu\).
When \(\Omega\) is unbounded, we will restrict our attention to the subset of \(\Pspace(\Omega)\) consisting of all probability measures with finite \(p\)-th moment:
\[
  \Pspace_p(\Omega) \coloneqq \left\{ \mu \in \Pspace(\Omega); \quad \int_{\Omega} \abs{x}^p \dd \mu(x) < +\infty \right\}.
\]
This, as we will see in the next proposition, will ensure the finiteness of the \vocab{Wasserstein distance of order \(p\)}, defined by
\[
  W_p(\mu, \nu)
  \coloneqq \left( C_{d^p}(\mu, \nu) \right)^{1/p}
  = \left( \min_{\gamma \in \Pi(\mu, \nu)} \int_{\Omega \times \Omega} \abs{x - y}^p \dd \gamma(x, y) \right)^{1/p}.
\]
Here, the existence of the \(\min\) is established by \Cref{prop:Kan-existence}.
The space \(\Pspace_p(\Omega)\) endowed with the (to be proven) metric \(W_p\) is called the \vocab{Wasserstein space of order \(p\)}.

Before proving that \(W_p\) is a distance, we first state a few immediate observations:
\begin{proposition}\label{prop:Wdist-top-equiv}~
  \begin{enumerate}[label=(\roman*)]
    \item If \(\mu, \nu \in \Pspace_p(\Omega)\), then \(W_p(\mu, \nu) < +\infty\).
    \item\label{item:Wspace-relation-ii} If \(1 \leq p \leq q\), then \(\Pspace_q(\Omega) \subset \Pspace_p(\Omega)\) and \(W_p(\mu, \nu) \leq W_q(\mu, \nu)\).
    \item When \(\Omega\) is bounded, \(\Pspace_p(\Omega) = \Pspace(\Omega)\) for all \(p \geq 1\), and
      \[
        W_1(\mu, \nu) \leq W_p(\mu, \nu) \leq \diam(\Omega)^{\frac{p - 1}{p}} W_1(\mu, \nu)^{\frac{1}{p}}.
      \]
      In particular, each \(W_p\) induce the same topology on \(\Pspace(\Omega)\).
  \end{enumerate}
\end{proposition}
\begin{proof}~
  \begin{enumerate}[label=(\roman*)]
    \item Let \(\gamma \in \Pspace(\mu, \nu)\) be any transport plan.
      From \(\abs{x - y}^p \leq C (\abs{x}^p + \abs{y}^p)\) we have
      \[
        \int \abs{x - y}^p \dd \gamma
        \leq C \left( \int \abs{x}^p \dd \mu + \int \abs{y}^p \dd \nu \right)
        < +\infty.
      \]
      \item Since \(x \mapsto \abs{x}^{q / p}\) is convex, we have by Jensen's inequality that
        \[
          \left( \int \abs{x}^p \dd \mu \right)^{\frac{q}{p}}
          \leq \int \abs{x}^q \dd \mu.
        \]
        Higher moment finiteness implies lower moment finiteness.

        Similarly, for the second result, let \(\gamma\) be an optimal transport plan for \(W_q(\mu, \nu)\) and we have
        \[
          W_p^p(\mu, \nu)
          \leq \int \abs{x - y}^p \dd \gamma
          \leq \left( \int \abs{x - y}^q \dd \gamma \right)^{\frac{p}{q}}
          = W_q(\mu, \nu)^p.
        \]
      \item
        In light of \ref{item:Wspace-relation-ii}, we need only prove \(\Pspace(\Omega) \subset \Pspace_p(\Omega)\) and the second equality.
        The inclusion is given by \(\int \abs{x}^p \dd \mu \leq \diam(\Omega)^p\).
        For the inequality, let \(\gamma\) be an optimal transport plan for \(W_1(\mu, \nu)\) and note that
        \[
          W_p^p(\mu, \nu)
          \leq \int \abs{x - y}^p \dd \gamma
          \leq \diam(\Omega)^{p - 1} \int \abs{x - y} \dd \gamma
          = \diam(\Omega)^{p - 1} W_1(\mu, \nu).
        \]
  \end{enumerate}
\end{proof}


We next turn our attention to establishing that \(W_p\) is indeed a metric on \(\Pspace_p(\Omega)\).
Positive definiteness and symmetry are quite easy:
\begin{proposition}
  Let \(p \in [1, +\infty)\).
  The function \(W_p\) is symmetric and nonnegative.
  Moreover, \(W_p(\mu, \nu) = 0\) if and only if \(\mu = \nu\).
\end{proposition}
\begin{proof}
  The nonnegativity of \(W_p\) is inherited from that of the cost function.
  Symmetric is obtained by noting that for each transport plan \(\gamma \in \Pi(\mu, \nu)\), we can define a ``reverse plan'' \(S_{\#} \gamma \in \Pi(\nu, \mu)\), where \(S: \Omega \times \Omega \to \Omega \times \Omega\) is defined by \(S(x, y) \coloneqq (y, x)\).
  We have
  \[
    W_p^p(\nu, \mu)
    \leq \int \abs{x - y}^p \dd S_{\#} \gamma(x, y)
    = \int \abs{y - x}^p \dd \gamma(x, y).
  \]
  Taking the infimum over all \(\gamma \in \Pi(\mu, \nu)\) gives \(W_p(\nu, \mu) \leq W_p(\mu, \nu)\).
  The reverse inequality is obtained by interchanging \(\mu\) and \(\nu\).

  Finally, suppose
  \[
    W_p(\mu, \nu)
    = \left( \int \abs{x - y}^p \dd \gamma(x, y) \right)^{\frac{1}{p}}
    = 0.
  \]
  Then \(\gamma\) is supported on \(\{x = y\}\).
  Thus for any measurable set \(A \subset \Omega\) we have
  \begin{align*}
    \mu(A)
    = \gamma(A \times \Omega)
    &= \gamma\left( (A \times \Omega) \cap \{x = y\} \right) \\
    &= \gamma(\Omega \times A)
    = \nu(A),
  \end{align*}
  which shows that \(\mu = \nu\).
\end{proof}


Establishing the triangle inequality is more involved.
We will deal with the cases \(p = 1\) and \(p > 1\) separately.
The case \(p = 1\) follows from the Kantorovich-Rubinstein Theorem quite easily.
For \(p > 1\), we will leverage the strict convexity of the cost and use \Cref{prop:Mon-existence}.

\subsubsection{Triangular Inequality: The case \texorpdfstring{\(p = 1\)}{p = 1}}
\begin{proposition}
  The function \(W_1\) satisfies the triangle inequality.
\end{proposition}
\begin{proof}
Starting from the identity
\[
  \int_{\Omega} \varphi \dd (\mu - \nu)
  = \int_{\Omega} \varphi \dd (\mu - \rho) + \int_{\Omega} \varphi \dd (\rho - \nu)
\]
we have
\begin{align*}
  W_1(\mu, \nu)
  &= \sup_{\norm{\varphi} \leq 1} \int_{\Omega} \varphi \dd (\mu - \nu) \\
  &\leq \sup_{\norm{\varphi} \leq 1} \int_{\Omega} \varphi \dd (\mu - \rho)
    + \sup_{\norm{\varphi} \leq 1} \int_{\Omega} \varphi \dd (\rho - \nu) \\
  &= W_1(\mu, \rho) + W_1(\rho, \nu),
\end{align*}
where the equalities follow from the Kantorovich-Rubinstein Theorem (\Cref{prop:Kan-Rub}).
\end{proof}


\subsubsection{Triangular Inequality: The case \texorpdfstring{\(p \in (1, +\infty)\)}{p > 1}}
When \(\mu\) and \(\rho\) are both absolutely continuous with respect to the Lebesgue measure, optimal transport maps exist by \Cref{prop:Mon-existence}, and we can rather easily reduce the problem to triangle inequality in the \(L^p\) space.
When this is not true, we can approximate \(\mu\) and \(\rho\) with absolutely continuous measures obtained by convolution, and pass to the limit with aid from the following lemma:

\begin{lemma}\label{prop:Wdist-convolution}
  Consider \(\mu, \nu \in \Pspace_p(\RR^d)\) and \(\chi_{\varepsilon}\) an even mollifier in \(L^1\) such that \(\int_{\RR^d} \chi_{\epsilon}(x) \dd x = 1\), \(\chi_{\epsilon}(x) = \epsilon^{-d} \chi_1(x / \epsilon)\), and \(\chi_1\) is compactly supported on the unit ball.
  Write \(\mu_{\varepsilon} \coloneqq \mu * \chi_{\varepsilon}\) and \(\nu_{\varepsilon} \coloneqq \nu * \chi_{\varepsilon}\).
  We have
  \begin{enumerate}[label=(\roman*)]
    \item \(W_p(\mu_{\varepsilon}, \nu_{\epsilon}) \leq W_p(\mu, \nu)\),
    \item \(\lim_{\varepsilon \to 0} W_p(\mu_{\epsilon}, \nu_{\epsilon}) = W_p(\mu, \nu)\).
  \end{enumerate}
\end{lemma}
\begin{proof}~
  \proofstep{(i) \(W_p(\mu_{\varepsilon}, \nu_{\varepsilon}) \leq W_p(\mu, \nu)\)}
  Let \(\gamma\) be the optimal transport plan for \(W_p(\mu, \nu)\).
  We use \(\gamma\) to define a candidate transport plan between \(\mu_{\epsilon}\) and \(\nu_{\epsilon}\).
  The functional
  \[
    L
    : \varphi(x, y)
    \mapsto
    \int_{\RR^d \times \RR^d} \int_{\RR^d} \varphi(x - z, y - z) \chi_{\varepsilon}(z) \dd z \dd \gamma(x, y)
  \]
  is positive when \(\varphi \geq 0\), linear, and continuous with respect to the sup norm.
  By the Riesz representation theorem, it defines a unique measure \(\gamma_{\varepsilon}\) by \(L(\varphi) = \int \varphi \dd \gamma_{\epsilon}\).
  We check that it lives in \(\Pi(\mu_{\varepsilon}, \nu_{\varepsilon})\):
  for any \(\varphi \in C_c(\RR^d)\),
  \begin{align*}
    \int \varphi(x) \dd \gamma_{\varepsilon}
    &= \iint \varphi(x - z) \chi_{\varepsilon}(z) \dd z \dd \mu(x) \\
    &= \iint \varphi(z) \chi_{\varepsilon}(x - z) \dd \mu(x) \dd z \\
    &= \int \varphi(z) \int \chi_{\varepsilon}(z - x) \dd \mu(x) \dd z
    = \int \varphi \dd \mu_{\varepsilon},
  \end{align*}
  where the second line comes from interchanging the two integrals and a change of variable, and the third line comes from \(\chi_{\varepsilon}\) being even.
  This shows that the first marginal of \(\gamma_{\varepsilon}\) is \(\mu_{\varepsilon}\).
  An analogous argument shows that the second marginal is \(\nu_{\varepsilon}\).
  Using this transport plan, we have the bound
  \[
    W_p^p(\mu_{\varepsilon}, \nu_{\varepsilon})
    \leq \iint \abs{x - z - y + z}^p \chi_{\varepsilon}(z) \dd z \dd \gamma_{\varepsilon}
    = \int \abs{x - y}^p \dd \gamma_{\varepsilon}
    = W_p^p(\mu, \nu).
  \]

  \proofstep{(ii) \(\lim_{\varepsilon \to 0} W_p(\mu_{\varepsilon}, \nu_{\varepsilon}) = W_p(\mu, \nu)\)}
  The inequality above gives \(\limsup W_p(\mu_{\varepsilon}, \nu_{\varepsilon}) \leq W_p(\mu, \nu)\).
  It thus suffices to show
  \[
    \liminf W_p(\mu_{\varepsilon_n}, \nu_{\varepsilon_n}) \geq W_p(\mu, \nu)
  \]
  for an arbitrary sequence \(\varepsilon_n \to 0\).
  This will be done using the lower semi-continuity of \(\Kan\).

  We start with showing that the families \(\{\mu_{\varepsilon_n}\}\) and \(\{\nu_{\varepsilon_n}\}\) are tight.
  Find for each \(\delta > 0\) a compact \(K_0\) such that \(\mu(K_0^\complement) < \delta\).
  Then, enlarge \(K_0\) by \(1\), the radius of the support of \(\chi_1\), to obtain
  \[
    K
    \coloneqq \bigcup_{x \in K_0} \overline{B}(x, 1)
    % \coloneqq K_0 + B(0)
    = \left( x \mapsto d(x, K_0) \right)^{-1} ([0, 1]).
  \]
  It is easy to verify that \(K\) is compact (being closed and bounded).
  We have
  \[
    \mu_{\varepsilon}(K)
    = \int \mu(K - x) \chi_{\varepsilon}(x) \dd x
    \leq \int \mu(K_0) \chi_{\varepsilon}(x) \dd x
    = \mu(K_0),
  \]
  where the inequality follows from the fact that \(K_0 + x \subset K\) for each \(x \in \supp \chi_1 \subset B(0, 1)\).
  The same argument shows that \(\{\nu_{\varepsilon_n}\}\) is tight.

  Now let \(\gamma_{\varepsilon_n}\) be the optimal transport plan for \(W_p(\mu_{\varepsilon_n}, \nu_{\varepsilon_n})\) and note that we have \(\mu_{\varepsilon_n} \weakto \mu\) and \(\nu_{\varepsilon_n} \weakto \nu\).
  We a pick subsequence that attains \(\liminf W_p(\mu_{\varepsilon_n}, \nu_{\varepsilon_n})\), and, by \Cref{prop:couplings-of-tight-is-tight}, a further subsequence \(\varepsilon_{n_k}\) such that \(\gamma_{\varepsilon_{n_k}}\) converges weakly to some \(\gamma\).
  We check that \(\gamma \in \Pi(\mu, \nu)\):
  for each \(\varphi \in C_b(\Omega)\), we have by a change of variable that
  \[
    \int \varphi \dd ({\pi_1}_{\#} \gamma_{\varepsilon_{n_k}})
    = \int \varphi \circ \pi_1 \dd \gamma_{\varepsilon_{n_k}},
  \]
  where \(\pi_1: (x, y) \mapsto x\) projects to the first coordinate.
  As we send \(n \to \infty\), the left side converges to \(\int \varphi \dd \mu\) by the fact that \({\pi_1}_{\#} \gamma_{\varepsilon_{n_k}} = \mu_{\varepsilon_{n_k}} \weakto \mu\).
  Similarly, from \(\gamma_{\varepsilon_{n_k}} \weakto \gamma\) we know that the right side converges to \(\int \varphi \circ \pi_1 \dd \gamma = \int \varphi \dd ({\pi_1}_{\#} \gamma)\).
  We then have by uniqueness of limits that \(\int \varphi \dd \mu = \int \varphi \dd ({\pi_1}_{\#} \gamma)\).
  Since \(\varphi \in C_b(\Omega)\) is arbitrary, \(\gamma\) has first marginal \(\mu\).
  Its second marginal is by the same argument \(\nu\).

  We now have
  \[
    \liminf W_p(\mu_{\varepsilon_n}, \nu_{\varepsilon_n})
    = \lim \Kan(\gamma_{\varepsilon_{n_k}})
    \geq \Kan(\gamma) \geq W_p(\mu, \nu),
  \]
  where the equality comes from how we selected the subsequence \(\varepsilon_{n_k}\), the first inequality from \Cref{prop:Kan-lsc}, and the second inequality from \(\gamma\) being an admissible transport plan.
  Since \(W_p(\mu_{\varepsilon}, \nu_{\varepsilon}) \leq W_p(\mu, \nu)\) for each \(\varepsilon\), we conclude that \(\lim W_p(\mu_{\varepsilon_n}, \nu_{\varepsilon_n}) = W_p(\mu, \nu)\).
\end{proof}


\begin{theorem}
  \(W_p\) is a metric on \(\Pspace_p(\Omega)\) for each \(p \geq 1\).
\end{theorem}
\begin{proof}
  \todo{add}
  Finally, to show triangular inequality, we suppose first that \(\mu\) and \(\rho\) are absolutely continuous.
  By \Cref{prop:Mon-existence} there exists optimal transport maps \(S\) and \(T\) such that \(\rho = S_{\#} \nu\) and \(\nu = T_{\#} \rho\).
  Since \((T \circ S)_{\#} \mu = T_{\#} \rho = \nu\), \(T \circ S\) is a transport map from \(\mu\) to \(\nu\).
  Thus we have
  \begin{align*}
    W_p(\mu, \nu)
    \leq \left( \int \abs{T \circ S - \Id}^p \dd \mu \right)^{1 / p}
    &\leq \left( \int \abs{S - \Id}^p \dd \mu \right)^{1 / p} + \left( \int \abs{T \circ S - S}^p \dd \mu \right)^{1 / p} \\
    &= \left( \int \abs{S - \Id}^p \dd \mu \right)^{1 / p} + \left( \int \abs{T - \Id}^p \dd \rho \right)^{1 / p} \\
    &= W_p^p(\mu, \rho) + W_p^p(\rho, \nu),
  \end{align*}
  where the second inequality follows from the triangular inequality for \(L^p(\mu)\), and the second line follows from a change of variable.

  When \(\mu\) or \(\rho\) is not absolutely continuous, the discussion above gives
  \[
    W_p(\mu_{\varepsilon}, \nu_{\varepsilon})
    \leq W_p(\mu_{\varepsilon}, \rho_{\varepsilon}) + W_p(\rho_{\varepsilon}, \nu_{\varepsilon}),
  \]
  where \(\mu_{\varepsilon}, \nu_{\varepsilon}, \rho_{\varepsilon}\) are as defined in \Cref{prop:Wdist-convolution}.
  The same Lemma then allows us to pass to the limit.
\end{proof}


\subsection{Topology of the Wasserstein Space}
As with dealing with the triangular inequality, we will split into the case \(p = 1\) and \(p \in (1, +\infty)\).
\draftnote[TODO]{Add}

\begin{theorem}
  If \(\Omega \subset \RR^d\) is bounded and \(p \in [1, +\infty)\), then \(W_p(\mu_n, \mu) \to 0\) if and only if \(\mu_n \weakto \mu\).
\end{theorem}


\begin{theorem}
  Let \(p \in [1, +\infty)\).
  We have \(W_p(\mu_n, \mu) \to 0\) if and only if \(\mu_n \weakto \mu\) and \(\int \abs{x}^p \dd \mu_n \to \int \abs{x}^p \dd \mu\).
\end{theorem}




\section{Curves and Geodesics in the Metric Space}
\subsection{Curves}
\begin{definition}[Curve, Speed]
  A \vocab{curve} \(\omega\) is a continuous function defined on \([0, 1]\) and valued in a metric space \((X, d)\).
  \begin{itemize}
    \item Its \vocab{length} is defined as
      \[
        \length(\omega)
        \coloneqq \sup\left\{\sum_{k = 0}^{k - 1} d(\omega(t_k), \omega(t_{k + 1})): n \geq 1, 0 = t_0 < t_1 < \dots < t_n = 1 \right\}.
      \]
    \item Its \vocab{speed} \(\abs{\omega'}\) is defined as
      \[
        \abs{\omega'}(t) \coloneqq \lim_{h \to 0} \frac{d(\omega(t + h), \omega(t))}{\abs{h}},
      \]
      if the limit exists.
    \item The curve \(\omega\) is said to be \vocab{absolutely continuous} if there exists a \(g \in L^1\) such that
      \[
        d(\omega(s), \omega(t)) \leq \int_s^t g(r) \dd r, \quad \forall s, t \in [0, 1], s \leq t.
      \]
      The set of all absolutely continuous curves is denoted by \(\AC(X)\).
  \end{itemize}
\end{definition}


\begin{remark}~
  \begin{itemize}
    \item The Rademacher theorem implies that the speed exists for a.e.\ \(t\).
    \item If \(\omega\) is absolutely continuous, then it has finite length bounded above by \(\int_0^1 g(r) \dd r\).
      \item For any curve \(\omega \in \AC(X)\), we have \(\length(\omega) = \int_0^1 \abs{\omega'}(t) \dd t\).
  \end{itemize}
\end{remark}


\begin{proposition}
  Absolutely continuous curves can be reparametrized in time to be Lipschitz.
\end{proposition}


\subsection{Geodesics}

\begin{definition}[Geodesic, Geodesic Space]
  A curve \(\omega: [0, 1] \to X\) is a \vocab{geodesic} between \(x_0, x_1 \in X\) if it minimizes the length among all curves such that \(\omega(0) = x_0\) and \(\omega(1) = x_1\).
  It is said to be a \vocab{constant speed geodesic} if for each \(s, t \in [0, 1]\) we have
  \[
    d(\omega(s), \omega(t)) = \abs{s - t} d(\omega(0), \omega(1)).
  \]
  A metric space is a \vocab{geodesic space} if for each \(x, y \in X\) there exists a geodesic connecting \(x\) and \(y\).
\end{definition}

\begin{proposition}
  Fix \(p > 1\) and consider curves connecting \(x_0\) to \(x_1\).
  The following are equivalent:
  \begin{enumerate}[label=(\roman*)]
    \item \(\omega\) is a constant speed geodesic,
    \item \(\omega \in \AC(X)\) and \(\abs{\omega'}(t) = d(x_0, x_1)\) for a.e.\ \(t\),
    \item \(\omega\) solves \(\min\left\{\int_0^1 \abs{\omega'}(t)^p \dd t: \omega(0) = x_0, \omega(1) = x_1 \right\}\).
  \end{enumerate}
\end{proposition}



\subsection{The Continuity Equation}
\begin{definition}[Weak Solutions of the Continuity Equation]
\end{definition}

\begin{proposition}
Equivalence of weak and distributional solutions to the CE.
\end{proposition}






\section{AC curves in the Wasserstein Space and the Benamou-Brenier Formula}
\begin{theorem}
  Let \((\mu_t)_{t \in [0, 1]}\) be an absolutely continuous curve in \(\Wspace(\Omega)\), where \(p > 1\) and \(\Omega \subset \RR^d\) is compact.
  For a.e.\ \(t\), there exists a vector field \(v_t \in L^p(\mu_t; \RR^d)\) such that the continuity equation \(\partial_t \mu_t + \divg (v_t \mu_t) = 0\) is satisfied in the weak sense, and for a.e.\ \(t\) we have \(\norm{v_t}_{L^p(\mu_t)} \leq \abs{\mu'}(t)\).

  Conversely, if \((\mu_t)_{t \in [0, 1]}\) is a family of measures in \(\Pspace_p(\Omega)\) and for each \(t\) we have a vector field \(v_t \in L^p(\mu_t; \RR^d)\) with \(\int_0^1 \abs{v_t}_{L^p(\mu_t)} \dd t < +\infty\) solving \(\partial_t \mu_t + \divg (v_t \mu_t) = 0\), then \((\mu_t)_t\) is absolutely continuous in \(\Wspace(\Omega)\) and for a.e.\ \(t\), we have \(\abs{\mu'}(t) \leq \norm{v_t}_{L^p(\mu_t)}\).
\end{theorem}







\end{document}
